language: ruby
cache: bundler
rvm:
- 2.6.3
addons:
  apt:
    packages:
    - openjdk-8-jre
before_install:
- gem update --system
- gem install bundler
- nvm install node
install:
- bundle install --jobs=3 --retry=3
- pip install --user html5validator
- npm install -g pa11y-ci
script:
- bundle exec jekyll clean && bundle exec jekyll build
- html5validator --Werror --also-check-css --also-check-svg --root _site/
- |
  (bundle exec jekyll server -d _tmp_site & echo $! >&3) 3>jekyll.pid | grep -q 'Server running' && \
  pa11y-ci --sitemap http://localhost:4000/whiteglass/sitemap.xml && \
  kill -9 "$(cat jekyll.pid)" && \
  rm -f jekyll.pid
branches:
  only:
  - master
deploy:
  provider: pages
  skip-cleanup: true
  github-token: f2wDbB1CETIvQhBSDca0FV8ZKvr13op3lZJy6DybQZ5xk4qsBCucLr0Dz2El/v/z8V3ZCAwKKgLuh6+I6nofpIazRKB9SMSVvPdv6fjd06KW08l3KUy0GjWtmB7aOr4HLzHyiLEqXZXoo9pYGl2QKPxH8kJjj0jxDuBdxy6M5ndYOZlqgUXayFqyg5j4UZ86X+4ZHYc0azesyisiPNJSbaI9lIS8YxVfThJWrxvkHIykiGlcgNippURT7MEOAJBeJlIKW7oDw0R0rPVSB7lUJU2NE8IgcTeTLMm0D00oIfYq1D/V4wr1dxeglgFPV0R8Go81ojye5N2EEIvVecd6T/EeWJrdjlPV5K+f9HfdrmOwMqsHLDG1u5buxvgL6fNjWnU/j+Ml89RyHkJGsCxXcrct4NZy7UdwWl4YLwbkn6mctUvPtKEShndKBu1Dih7GZ1X/C7N65EBsdlpoEhKdxvZE6QWtuIR78MgxfXS1QN9iHFVcAu28TNx/nvrjPKs/AIicIZc0PM/XZL7wVJpb5ZURC78IK0c9JdvcYXw0lQFQZNTvp1Oio65wRSUBVjBZetitnRE0iMsL2SPycuewStthz5LRIBX8PTNk6EhqexH0/lll+1xi43GuYnvpQzgpBCm59A9clTBxaGBHUHvFg3QWWlN0jE2sNVhaFXzq2Z4=
  keep-history: true
  local-dir: _site
  target-branch: mater
  on:
    branch: master