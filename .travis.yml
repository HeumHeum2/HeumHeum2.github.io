language: ruby
cache: bundler
rvm:
- 2.6.3
addons:
  apt:
    packages:
    - openjdk-8-jre
before_install:
- gem update --system
- gem install bundler
- nvm install node
install:
- bundle install --jobs=3 --retry=3
- pip install --user html5validator
- npm install -g pa11y-ci
script:
- bundle exec jekyll clean && bundle exec jekyll build
- html5validator --Werror --also-check-css --also-check-svg --root _site/
- |
  (bundle exec jekyll server -d _tmp_site & echo $! >&3) 3>jekyll.pid | grep -q 'Server running' && \
  pa11y-ci --sitemap http://localhost:4000/whiteglass/sitemap.xml && \
  kill -9 "$(cat jekyll.pid)" && \
  rm -f jekyll.pid
branches:
  only:
  - master
deploy:
  provider: pages
  cleanup: true
  keep-history: true
  github-token: $GITHUB_TOKEN
  local-dir: _site
  target-branch: gh-pages
  on:
    branch: master
  
env:
  global:
    secure: QRnutT8Mf2eCckybdN7iGJmMUhOnjqA4TomOsH14uNzZaHjm0poRKMCG5hHPzVozOxoym5Nk9BZr7HTEKq+by/CvMnoHk25Y5082Zam6G6n32kswsDzhBTHI/7V9Ltah4vxVOmvUq+f392Vh8kWpm2HOsgteOrK7f36XsS+qKEVN0RJRFsA65Evrx1uO3SecOLKCYOa2ZUsuaApga3dtDNdQadJv2RjlGXl7WmChqewvYCg9TnKx534GebIq7XpHRW1fA6I/tTAwpPyLLUbzu0kLlOBAfEnwYULqrxTwYPmrU58/w/q/Y4hhEI0N7Fhth65+0gVywY2NA0gGRwraadcbFTZNNA2yx+CK0z8dogyjnr1e6XJBc0RtBqtX45/IjRgi0+YNERAZJkSLRbA1AIHi0M8Y2ROYJyNro650+CSqDiy+mZqg0t1lEAWJavjKh2tCLrbwR61R+2sWb6HBjiCfiXqPuYu+32zi7dGVGaorlGUeBP9IURUV0z4d2HqUd6ogahYIXfTDYA/e/ffA8zszb3jh2SLSa0Ukv+Gou8nRC00Ue9nUzNOdym9aE9OEkyDZsxsXUUq3P8ye0lsKuqPoiLQvjHCuhJwP1DS47KW3adQ1EjqKDx+WELrhMxfuE2de9QxfajkgHXdWrmQgnQiqiLERnPwHqw8dFlCx9lc=
